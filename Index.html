<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Un mensaje para ti ‚ú®</title>
  <style>
    :root{--bg:#0f1020;--card:#0f1724;--accent:#ff6b6b}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#eef2ff;background:radial-gradient(ellipse at 10% 10%, #1b1b2f 0%, #0f1020 35%), linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.1));min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:760px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));border-radius:16px;padding:32px;box-shadow:0 8px 30px rgba(2,6,23,0.6);position:relative;overflow:hidden}
    h1{margin:0 0 8px;font-size:28px;letter-spacing:-0.02em}
    p.lead{margin:0 0 18px;color:#dbe7ff;opacity:0.95}
    .big-msg{display:flex;align-items:center;justify-content:center;min-height:220px}
    .message{font-size:22px;line-height:1.4;text-align:center;padding:18px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter:blur(2px)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:18px}
    button, input[type=text]{border:0;padding:12px 16px;border-radius:10px;font-size:15px}
    button{cursor:pointer;background:linear-gradient(90deg,var(--accent),#ff9a9e);color:white;box-shadow:0 6px 18px rgba(255,107,107,0.18)}
    .muted{background:transparent;color:#9fb0ff;border:1px solid rgba(255,255,255,0.03)}
    .small{font-size:13px;padding:8px 10px}
    .row{display:flex;gap:8px;align-items:center;justify-content:center}
    .form-inline{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:14px}
    input[type=text]{background:rgba(255,255,255,0.02);color:#eaf2ff;border:1px solid rgba(255,255,255,0.03);min-width:220px}
    .heart{position:absolute;right:20px;bottom:20px;font-size:38px;transform:translateY(20px);opacity:0;transition:all .6s cubic-bezier(.2,.9,.3,1)}
    .heart.show{transform:translateY(0);opacity:1}
    .credit{position:absolute;left:18px;bottom:18px;color:rgba(255,255,255,0.35);font-size:12px}

    /* simple confetti particles */
    #confetti{position:absolute;inset:0;pointer-events:none}

    @media (max-width:520px){.card{padding:18px}.message{font-size:18px}.big-msg{min-height:180px}}
  </style>
</head>
<body>
  <div class="card" role="main">
    <h1>Un mensajito especial</h1>
    <p class="lead">Haz clic en "Revelar" para ver el mensaje. Puedes personalizarlo y crear un enlace para compartir.</p>

    <div class="big-msg">
      <div id="display" class="message">Aqu√≠ aparecer√° tu mensaje... üíå</div>
    </div>

    <div class="form-inline">
      <input id="nameInput" type="text" placeholder="Nombre (opcional)" aria-label="Nombre" />
      <input id="msgInput" type="text" placeholder="Escribe tu mensaje aqu√≠..." aria-label="Mensaje" />
      <button id="revealBtn">Revelar</button>
    </div>

    <div class="controls">
      <button id="linkBtn" class="small muted">Generar link para compartir</button>
      <button id="copyBtn" class="small muted">Copiar mensaje</button>
      <button id="surpriseBtn" class="small">Sorpresa üéâ</button>
    </div>

    <div class="row" style="margin-top:12px;justify-content:center">
      <span id="linkArea" style="font-size:14px;color:#bcd3ff;opacity:0.9;word-break:break-all"></span>
    </div>

    <div class="credit">Creado con cari√±o</div>
    <div id="confetti"></div>
    <div id="heart" class="heart">‚ù§Ô∏è</div>
  </div>

  <script>
    // Helpers
    const $ = id => document.getElementById(id)
    const params = new URLSearchParams(location.search)

    function decodeParam(p){try{return decodeURIComponent(p)}catch(e){return p}}

    // If URL contains ?msg=... and ?name=..., show directly
    const urlMsg = params.get('msg')
    const urlName = params.get('name')
    const display = $('display')
    if(urlMsg){
      const name = urlName? decodeParam(urlName) : ''
      const full = name? `${name}, ${decodeParam(urlMsg)}` : decodeParam(urlMsg)
      revealMessage(full)
      // Add small pulse
      document.getElementById('heart').classList.add('show')
      launchConfetti(120)
    }

    // Button handlers
    $('revealBtn').addEventListener('click', ()=>{
      const name = $('nameInput').value.trim()
      const msg = $('msgInput').value.trim()
      const full = name ? `${name}, ${msg || '¬°Te quiero mucho! üíñ'}` : (msg || '¬°Te quiero mucho! üíñ')
      revealMessage(full)
      $('linkArea').textContent = ''
    })

    $('linkBtn').addEventListener('click', ()=>{
      const name = $('nameInput').value.trim()
      const msg = $('msgInput').value.trim() || '¬°Te quiero mucho!'
      const u = new URL(location.href)
      u.searchParams.set('msg', encodeURIComponent(msg))
      if(name) u.searchParams.set('name', encodeURIComponent(name))
      const short = u.toString()
      $('linkArea').textContent = short
      copyToClipboard(short)
      $('linkBtn').textContent = 'Link copiado ‚úÖ'
      setTimeout(()=> $('linkBtn').textContent = 'Generar link para compartir',1500)
    })

    $('copyBtn').addEventListener('click', ()=>{
      copyToClipboard(display.textContent)
      $('copyBtn').textContent = 'Copiado ‚úÖ'
      setTimeout(()=> $('copyBtn').textContent = 'Copiar mensaje',1200)
    })

    $('surpriseBtn').addEventListener('click', ()=>{
      const surprises = [
        'Eres mi persona favorita en este mundo.',
        'Cada d√≠a a tu lado es mi mejor d√≠a.',
        'Gracias por existir ‚ù§Ô∏è',
        'Contigo todo tiene m√°s sentido.'
      ]
      const pick = surprises[Math.floor(Math.random()*surprises.length)]
      revealMessage(pick)
      launchConfetti(140)
      document.getElementById('heart').classList.add('show')
    })

    function revealMessage(text){
      display.textContent = ''
      const chars = text.split('')
      let i = 0
      const iv = setInterval(()=>{
        display.textContent += chars[i++]
        if(i>=chars.length) clearInterval(iv)
      },22)
      // small pulse + confetti
      setTimeout(()=>{
        launchConfetti(80)
        document.getElementById('heart').classList.add('show')
      }, chars.length*22 + 300)
    }

    function copyToClipboard(text){
      if(navigator.clipboard){
        navigator.clipboard.writeText(text).catch(()=>{
          fallbackCopy(text)
        })
      }else fallbackCopy(text)
    }
    function fallbackCopy(text){
      const t = document.createElement('textarea')
      t.value = text
      document.body.appendChild(t)
      t.select(); document.execCommand('copy'); document.body.removeChild(t)
    }

    // Minimal confetti (no external libs)
    function launchConfetti(amount=100){
      const canvas = document.createElement('canvas')
      canvas.width = innerWidth
      canvas.height = innerHeight
      canvas.style.position = 'fixed'
      canvas.style.left = 0; canvas.style.top = 0; canvas.style.zIndex = 9999; canvas.style.pointerEvents='none'
      document.body.appendChild(canvas)
      const ctx = canvas.getContext('2d')
      const particles = []
      for(let i=0;i<amount;i++){
        particles.push({x:Math.random()*canvas.width,y:-20,vy:1+Math.random()*6, vx:(Math.random()-0.5)*6, r:6+Math.random()*8, rot:Math.random()*360, vr:(Math.random()-0.5)*10, c: `hsl(${Math.floor(Math.random()*360)},70%,60%)`})
      }
      let t = 0
      const raf = ()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height)
        for(const p of particles){
          p.x += p.vx; p.y += p.vy; p.vy += 0.15; p.rot += p.vr
          ctx.save()
          ctx.translate(p.x,p.y)
          ctx.rotate(p.rot*Math.PI/180)
          ctx.fillStyle = p.c
          ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*0.7)
          ctx.restore()
        }
        t += 1
        if(t<220) requestAnimationFrame(raf)
        else { document.body.removeChild(canvas) }
      }
      raf()
    }

    // Accessibility: reveal with Enter on inputs
    ['nameInput','msgInput'].forEach(id=>{
      $(id).addEventListener('keydown', e=>{ if(e.key==='Enter') $('revealBtn').click() })
    })
  </script>
</body>
</html>
